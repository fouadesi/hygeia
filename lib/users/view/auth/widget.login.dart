import 'package:flutter/material.dart';import 'package:google_fonts/google_fonts.dart';import 'package:hygeia/users/controller/PatientProvider.dart';import 'package:hygeia/users/controller/authController.dart';import 'package:hygeia/users/controller/login.dart';import 'package:hygeia/users/data/model/patient.dart';import 'package:hygeia/users/view/auth/widget.forgot.dart';import 'package:hygeia/users/view/auth/widget.signup.dart';import 'package:ionicons/ionicons.dart';import 'package:hygeia/users/view/Home/widget.home.dart';import 'package:keyboard_visibility/keyboard_visibility.dart';import 'package:provider/provider.dart';import 'package:top_snackbar_flutter/custom_snack_bar.dart';import 'package:top_snackbar_flutter/top_snack_bar.dart';import 'component/message.error.dart';class Login extends StatefulWidget {  @override  _LoginState createState() => _LoginState();}class _LoginState extends State<Login> {  bool see_password= false;  bool cir = false ;  TextEditingController emailControlleur ;  TextEditingController passwordControlleur ;  @override  void initState() {    // TODO: implement initState    emailControlleur = TextEditingController();    passwordControlleur = TextEditingController();    super.initState();  }  @override  @override  Widget build(BuildContext context) {    double height = MediaQuery.of(context).size.height;    double width = MediaQuery.of(context).size.width ;    print(height);    print(width);    return SafeArea(      child: Scaffold(        resizeToAvoidBottomInset: false,        body: LayoutBuilder(        builder: (BuildContext context, BoxConstraints constraints) {        return  Container(            height: height,            width: constraints.biggest.height,            decoration: BoxDecoration(              image: DecorationImage(                image: AssetImage("assets/images/bgsss.png"),                fit: BoxFit.fill,              ),            ),            child: Column(              mainAxisAlignment: MainAxisAlignment.start,              children: [                SizedBox(                    height: height * 0.1                ),                Image.asset("assets/images/Layer2.png"),                SizedBox(                    height: height * 0.05                ),                Container(                  height: height * 0.40,                  width: width * 0.81,                  decoration: BoxDecoration(                    borderRadius: BorderRadius.circular(27),                    border: Border.all(                        color: Color.fromRGBO(112, 112, 112, 1),                        width: 0.1                    ),                    color: Color.fromRGBO(249, 251, 251, 1),                    boxShadow: [                      BoxShadow(                        color: Color.fromRGBO(0, 0, 0, 0.16),                        spreadRadius: 2,                        blurRadius: 2,                        offset: Offset(0, 2), // changes position of shadow                      ),                    ],                  ),                  child: Padding(                      padding: EdgeInsets.all(20),                      child: Column(                        children: [                          SizedBox(                            height: height * 0.01,                          ),                          Text("Se connecter", style: GoogleFonts.inter(                              color: Color.fromRGBO(1, 85, 156, 1),                              fontWeight: FontWeight.bold,                              fontSize: 35                          ),),                          SizedBox(                            height: height * 0.01,                          ),                          Column(                            children: [                              TextFormField(                                style: GoogleFonts.poppins(                                  color: Color.fromRGBO(21, 32, 43, 0.7),                                  fontSize: 15,                                ),controller: emailControlleur,                                decoration: InputDecoration(                                  hintStyle: GoogleFonts.poppins(                                    color: Color.fromRGBO(21, 32, 43, 0.7),                                    fontSize: 15,                                  ),                                  alignLabelWithHint: true,                                  hintText: "Email",                                  contentPadding: EdgeInsets.only(top: 22),                                  enabledBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  focusedBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  border: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  errorBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  focusedErrorBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                ),                              ),                              TextFormField(                                controller: passwordControlleur,                                style: GoogleFonts.poppins(                                  color: Color.fromRGBO(21, 32, 43, 0.7),                                  fontSize: 15,                                ),                                obscureText: see_password,                                decoration: InputDecoration(                                  suffixIcon: Container(                                    height: 5,                                    width: 5,                                    child: Builder(                                      builder: (context) {                                        if (!see_password) {                                          return GestureDetector(                                            onTap: () {                                              setState(() {                                                see_password = !see_password;                                              });                                            },                                            child: Align(                                                alignment: Alignment                                                    .bottomCenter,                                                child: Padding(                                                    padding: EdgeInsets.only(                                                        bottom: 5),                                                    child: Icon(                                                      Ionicons.eye_outline,                                                      color: Color.fromRGBO(                                                          112, 112, 112, 1),                                                      size: 20,))),                                          );                                        } else {                                          return GestureDetector(                                            onTap: () {                                              setState(() {                                                see_password = !see_password;                                              });                                            },                                            child: Align(                                                alignment: Alignment                                                    .bottomCenter,                                                child: Padding(                                                    padding: EdgeInsets.only(                                                        bottom: 5),                                                    child: Icon(                                                      Ionicons.eye_off_outline,                                                      color: Color.fromRGBO(                                                          112, 112, 112, 1),                                                      size: 20,))),                                          );                                        }                                      },),),                                  hintStyle: GoogleFonts.poppins(                                    color: Color.fromRGBO(21, 32, 43, 0.7),                                    fontSize: 15,                                  ),                                  alignLabelWithHint: true,                                  hintText: "Mot de passe",                                  contentPadding: EdgeInsets.only(top: 22),                                  enabledBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  focusedBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  border: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  errorBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                  focusedErrorBorder: UnderlineInputBorder(                                    borderSide: BorderSide(                                        color: Color.fromRGBO(61, 199, 201, 1)),                                  ),                                ),                              ),                              SizedBox(                                height: 5,                              ),                              InkWell(                                onTap: () {                                  Navigator.push(context, MaterialPageRoute(builder:                                      (context)=> Forgot()));                                 },                                child: Align(                                    alignment: Alignment.topRight,                                    child: Text("Mot de passe oublié ? ",                                      style: GoogleFonts.poppins(                                          color: Colors.black87,                                          fontSize: 11                                      ),)),                              ),                            ],                          ),                          SizedBox(                            height: height * 0.04,                          ),                          Column(                            children: [                             cir == true ?  CircularProgressIndicator() : CustomElevation(                                height: 39,                                child: FlatButton(                                    shape: new RoundedRectangleBorder(                                        borderRadius: new BorderRadius.circular(                                            12.0)),                                    padding: EdgeInsets.symmetric(horizontal: 25),                                    color: Color.fromRGBO(1, 85, 156, 1),                                    onPressed: () async {                                      if (!RegExp('^[a-zA-Z][a-zA-Z]?.[a-zA-Z]*@esi-sba.dz').hasMatch(emailControlleur.text)) {                                        showErrorMessage("Veuillez entrer une adresse e-mail valide",context);                                        return;                                      }                                      if(passwordControlleur.text.length<8) {                                        showErrorMessage("Veuillez entrer un mot de passe correct",context);                                        return;                                      }                                      setState(() {                                        cir  = true ;                                      });                           Future<Map<String, dynamic>> map =   AuthProvider().login(emailControlleur.text, passwordControlleur.text);                                      map.then((value)  {                                        Patient patient = value['user'];                                        setState(() {                                          cir = false;                                         });                                        if(patient == null) {                                          showErrorMessage("Email ou mot de passe incorrecte",context);                                          return;                                        }                                        Provider.of<UserProvider>(context, listen: false).setUser(patient);                                 Navigator.pushReplacement(context, MaterialPageRoute(builder: (context)=>Home()));                                      });                                    },                                    child: Text(                                      "Se Connecter", style: GoogleFonts.poppins(                                      color: Colors.white,                                      fontSize: 18,                                    ),)),                              ),                              SizedBox(                                height: height *0.017,                              ),                              GestureDetector(                                onTap: () {                                  Navigator.push(context, MaterialPageRoute(builder: (context)=> SignUp()));                                },                                  child: Text("Vous n'avez pas un compte ? S'inscrire",                                style: GoogleFonts.poppins(                                  color: Color.fromRGBO(21, 32, 43, 1),                                  fontSize: 11,                                ),))                            ],                          ),                        ],                      )),                ),              ],            ), /* add child content here */          );        }        ),      ),    );  }}class CustomElevation extends StatelessWidget {  final Widget child;  final double height;  CustomElevation({@required this.child, @required this.height})      : assert(child != null);  @override  Widget build(BuildContext context) {    return Container(      height: this.height,      decoration: BoxDecoration(        borderRadius: BorderRadius.all(Radius.circular(this.height / 1.7)),        boxShadow: <BoxShadow>[          BoxShadow(            color: Colors.grey.withOpacity(0.2),            blurRadius: height / 12,            offset: Offset(0, height / 5),          ),        ],      ),      child: this.child,    );  }}